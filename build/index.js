(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var a in s)e.o(s,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:s[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{getAvailableFocusAreas:()=>g,getAvailableModels:()=>u,getAvailableTones:()=>f,getError:()=>T,getFocusAreas:()=>v,getLastReview:()=>b,getReviewHistory:()=>A,getSelectedModel:()=>_,getSettings:()=>d,getTargetTone:()=>S,getUnresolvedNotesCount:()=>R,hasError:()=>p,isLoadingSettings:()=>h,isReviewing:()=>E});var s={};e.r(s),e.d(s,{clearError:()=>O,fetchSettings:()=>j,receiveSettings:()=>x,setAvailableFocusAreas:()=>C,setAvailableModels:()=>N,setAvailableTones:()=>M,startReview:()=>L,updateSettings:()=>k});const a=window.wp.plugins,i=window.wp.editor,r=window.wp.i18n,n=window.wp.primitives,o=window.ReactJSXRuntime;var l=(0,o.jsx)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,o.jsx)(n.Path,{fillRule:"evenodd",d:"M7.25 16.437a6.5 6.5 0 1 1 9.5 0V16A2.75 2.75 0 0 0 14 13.25h-4A2.75 2.75 0 0 0 7.25 16v.437Zm1.5 1.193a6.47 6.47 0 0 0 3.25.87 6.47 6.47 0 0 0 3.25-.87V16c0-.69-.56-1.25-1.25-1.25h-4c-.69 0-1.25.56-1.25 1.25v1.63ZM4 12a8 8 0 1 1 16 0 8 8 0 0 1-16 0Zm10-2a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z",clipRule:"evenodd"})});const c=window.wp.data;function d(e){return e.settings}function u(e){return e.availableModels}function _(e){return e.settings.defaultModel}function g(e){return e.availableFocusAreas}function v(e){return e.settings.defaultFocusAreas}function f(e){return e.availableTones}function S(e){return e.settings.defaultTone}function E(e){return e.isReviewing}function b(e){return e.lastReview}function A(e){return e.reviewHistory}function T(e){return e.error}function h(e){return e.isLoadingSettings}function R(e){return e.lastReview&&e.lastReview.notes?e.lastReview.notes.filter(e=>!e.resolved).length:0}function p(e){return null!==e.error}const w=window.wp.apiFetch;var y=e.n(w);const m={settings:{defaultModel:"claude-sonnet-4",defaultFocusAreas:["content","tone","flow"],defaultTone:"professional"},availableModels:[],availableFocusAreas:[],availableTones:[],isReviewing:!1,lastReview:null,reviewHistory:[],error:null,isLoadingSettings:!1},I={SET_SETTINGS:"SET_SETTINGS",UPDATE_SETTINGS:"UPDATE_SETTINGS",SET_AVAILABLE_MODELS:"SET_AVAILABLE_MODELS",SET_AVAILABLE_FOCUS_AREAS:"SET_AVAILABLE_FOCUS_AREAS",SET_AVAILABLE_TONES:"SET_AVAILABLE_TONES",START_REVIEW:"START_REVIEW",REVIEW_SUCCESS:"REVIEW_SUCCESS",REVIEW_ERROR:"REVIEW_ERROR",ADD_TO_HISTORY:"ADD_TO_HISTORY",CLEAR_ERROR:"CLEAR_ERROR",SET_LOADING_SETTINGS:"SET_LOADING_SETTINGS"};function*j(){yield{type:I.SET_LOADING_SETTINGS,isLoading:!0};try{return yield y()({path:"/ai-feedback/v1/settings",method:"GET"})}catch(e){throw yield{type:I.REVIEW_ERROR,error:new Error(e.message||"Failed to fetch settings")},e}}function x(e){return{type:I.SET_SETTINGS,settings:e}}function*k(e){try{const t=yield y()({path:"/ai-feedback/v1/settings",method:"POST",data:e});return{type:I.SET_SETTINGS,settings:t}}catch(e){throw yield{type:I.REVIEW_ERROR,error:new Error(e.message||"Failed to update settings")},e}}function*L({postId:e,model:t,focusAreas:s,targetTone:a}){yield{type:I.START_REVIEW};try{const i=yield y()({path:"/ai-feedback/v1/review",method:"POST",data:{post_id:e,model:t,focus_areas:s,target_tone:a}});return{type:I.REVIEW_SUCCESS,review:i}}catch(e){return{type:I.REVIEW_ERROR,error:new Error(e.message||"Review failed")}}}function O(){return{type:I.CLEAR_ERROR}}function N(e){return{type:I.SET_AVAILABLE_MODELS,models:e}}function C(e){return{type:I.SET_AVAILABLE_FOCUS_AREAS,areas:e}}function M(e){return{type:I.SET_AVAILABLE_TONES,tones:e}}const V="ai-feedback/store",F={reducer:function(e=m,t){switch(t.type){case I.SET_SETTINGS:return{...e,settings:{defaultModel:t.settings.default_model,defaultFocusAreas:t.settings.default_focus_areas,defaultTone:t.settings.default_tone},availableModels:t.settings.available_models||[],availableFocusAreas:t.settings.available_focus_areas||[],availableTones:t.settings.available_tones||[],isLoadingSettings:!1};case I.UPDATE_SETTINGS:return{...e,settings:{...e.settings,...t.settings}};case I.SET_AVAILABLE_MODELS:return{...e,availableModels:t.models};case I.SET_AVAILABLE_FOCUS_AREAS:return{...e,availableFocusAreas:t.areas};case I.SET_AVAILABLE_TONES:return{...e,availableTones:t.tones};case I.START_REVIEW:return{...e,isReviewing:!0,error:null};case I.REVIEW_SUCCESS:return{...e,isReviewing:!1,lastReview:t.review,reviewHistory:[t.review,...e.reviewHistory]};case I.REVIEW_ERROR:return{...e,isReviewing:!1,error:t.error};case I.ADD_TO_HISTORY:return{...e,reviewHistory:[t.review,...e.reviewHistory]};case I.CLEAR_ERROR:return{...e,error:null};case I.SET_LOADING_SETTINGS:return{...e,isLoadingSettings:t.isLoading};default:return e}},selectors:t,actions:s,controls:{},resolvers:{*getSettings(){return x(yield j())}}},D=(0,c.createReduxStore)(V,F);(0,c.register)(D);const B=window.wp.components;function P(){const{availableModels:e,selectedModel:t}=(0,c.useSelect)(e=>({availableModels:e(V).getAvailableModels(),selectedModel:e(V).getSelectedModel()}),[]),{updateSettings:s}=(0,c.useDispatch)(V),a=e.reduce((e,t)=>(e[t.provider]||(e[t.provider]=[]),e[t.provider].push(t),e),{}),i=[];return Object.keys(a).forEach(e=>{const t=e.charAt(0).toUpperCase()+e.slice(1);a[e].forEach(e=>{i.push({label:`${t} - ${e.name}`,value:e.id})})}),(0,o.jsx)(B.SelectControl,{label:(0,r.__)("AI Model","ai-feedback"),value:t,options:i,onChange:e=>{s({default_model:e})},help:(0,r.__)("Select the AI model to use for reviews","ai-feedback")})}const G=window.wp.element;function W(){const{availableFocusAreas:e,focusAreas:t,availableTones:s,targetTone:a}=(0,c.useSelect)(e=>({availableFocusAreas:e(V).getAvailableFocusAreas(),focusAreas:e(V).getFocusAreas(),availableTones:e(V).getAvailableTones(),targetTone:e(V).getTargetTone()}),[]),{updateSettings:i}=(0,c.useDispatch)(V),n=(0,G.useRef)(null);(0,G.useEffect)(()=>(n.current=function(e){let t;const s=function(...s){clearTimeout(t),t=setTimeout(()=>e.apply(this,s),500)};return s.cancel=()=>clearTimeout(t),s}(i),()=>{n.current&&n.current.cancel()}),[i]);const l=(0,G.useCallback)((e,s)=>{const a=s?[...t,e]:t.filter(t=>t!==e);n.current({default_focus_areas:a})},[t]),d=(0,G.useCallback)(e=>{n.current({default_tone:e})},[]);return(0,o.jsxs)("div",{className:"ai-feedback-settings",children:[(0,o.jsxs)("fieldset",{children:[(0,o.jsx)("legend",{children:(0,r.__)("Focus Areas","ai-feedback")}),(0,o.jsx)("p",{className:"description",children:(0,r.__)("Select the areas you want AI to focus on when reviewing your content","ai-feedback")}),e.map(e=>(0,o.jsx)(B.CheckboxControl,{label:e.label,help:e.description,checked:t.includes(e.id),onChange:t=>l(e.id,t)},e.id))]}),(0,o.jsx)(B.SelectControl,{label:(0,r.__)("Target Tone","ai-feedback"),value:a,options:s.map(e=>({label:e.label,value:e.id})),onChange:d,help:(0,r.__)("The desired tone for your content","ai-feedback")})]})}function U(){const{postId:e,isReviewing:t,selectedModel:s,focusAreas:a,targetTone:n}=(0,c.useSelect)(e=>({postId:e(i.store).getCurrentPostId(),isReviewing:e(V).isReviewing(),selectedModel:e(V).getSelectedModel(),focusAreas:e(V).getFocusAreas(),targetTone:e(V).getTargetTone()}),[]),{startReview:l}=(0,c.useDispatch)(V),d=!e||t;return(0,o.jsxs)("div",{className:"ai-feedback-review-button",children:[(0,o.jsx)(B.Button,{variant:"primary",onClick:async()=>{if(e)try{await l({postId:e,model:s,focusAreas:a,targetTone:n})}catch(e){console.error("Review failed:",e)}},disabled:d,isBusy:t,children:t?(0,r.__)("Reviewingâ€¦","ai-feedback"):(0,r.__)("Review Document","ai-feedback")}),!e&&(0,o.jsx)("p",{className:"description",children:(0,r.__)("Save your post first to enable review","ai-feedback")}),t&&(0,o.jsx)("p",{className:"description",children:(0,r.__)("AI is analyzing your contentâ€¦","ai-feedback")})]})}function H({review:e}){if(!e||!e.summary)return null;const{summary:t,notes:s,model_used:a}=e;return(0,o.jsxs)("div",{className:"ai-feedback-review-summary",children:[(0,o.jsx)("div",{className:"summary-stats",children:(0,o.jsxs)("div",{className:"stat",children:[(0,o.jsx)("strong",{children:t.total_notes||0}),(0,o.jsx)("span",{children:(0,r.__)("Total Feedback Items","ai-feedback")})]})}),t.by_severity&&(0,o.jsxs)("div",{className:"summary-by-severity",children:[(0,o.jsx)("h4",{children:(0,r.__)("By Severity","ai-feedback")}),(0,o.jsxs)("ul",{children:[t.by_severity.critical>0&&(0,o.jsxs)("li",{children:["ðŸ”´ ",(0,r.__)("Critical","ai-feedback"),":"," ",t.by_severity.critical]}),t.by_severity.important>0&&(0,o.jsxs)("li",{children:["ðŸŸ¡ ",(0,r.__)("Important","ai-feedback"),":"," ",t.by_severity.important]}),t.by_severity.suggestion>0&&(0,o.jsxs)("li",{children:["ðŸŸ¢ ",(0,r.__)("Suggestion","ai-feedback"),":"," ",t.by_severity.suggestion]})]})]}),t.by_category&&(0,o.jsxs)("div",{className:"summary-by-category",children:[(0,o.jsx)("h4",{children:(0,r.__)("By Category","ai-feedback")}),(0,o.jsx)("ul",{children:Object.entries(t.by_category).map(([e,t])=>(0,o.jsxs)("li",{children:[e.charAt(0).toUpperCase()+e.slice(1),": ",t]},e))})]}),a&&(0,o.jsx)("p",{className:"model-used",children:(0,o.jsxs)("em",{children:[(0,r.__)("Reviewed with:","ai-feedback")," ",a]})}),s&&s.length>0&&(0,o.jsxs)("div",{className:"notes-info",children:[(0,o.jsx)("p",{className:"description",children:(0,r.__)("Feedback notes have been attached to your content blocks. Look for the note indicators in the editor.","ai-feedback")}),e.note_ids&&e.note_ids.length>0&&(0,o.jsxs)("p",{className:"success",children:["âœ“ ",(0,r.__)("Created","ai-feedback")," ",e.note_ids.length," ",(0,r.__)("WordPress Notes","ai-feedback")]}),e.notes_error&&(0,o.jsxs)("p",{className:"error",children:["âš  ",(0,r.__)("Note creation warning:","ai-feedback")," ",e.notes_error]})]})]})}function Z(){const{error:e,lastReview:t,isLoadingSettings:s}=(0,c.useSelect)(e=>({error:e(V).getError(),lastReview:e(V).getLastReview(),isLoadingSettings:e(V).isLoadingSettings()}),[]);return s?(0,o.jsx)("div",{className:"ai-feedback-panel",children:(0,o.jsx)(B.PanelBody,{children:(0,o.jsx)("p",{children:(0,r.__)("Loadingâ€¦","ai-feedback")})})}):(0,o.jsxs)("div",{className:"ai-feedback-panel",children:[e&&(0,o.jsx)(B.Notice,{status:"error",isDismissible:!1,children:e.message}),(0,o.jsxs)(B.PanelBody,{title:(0,r.__)("Review Settings","ai-feedback"),initialOpen:!0,children:[(0,o.jsx)(P,{}),(0,o.jsx)(W,{})]}),(0,o.jsx)(B.PanelBody,{title:(0,r.__)("Review Document","ai-feedback"),initialOpen:!0,children:(0,o.jsx)(U,{})}),t&&(0,o.jsx)(B.PanelBody,{title:(0,r.__)("Last Review","ai-feedback"),initialOpen:!0,children:(0,o.jsx)(H,{review:t})})]})}(0,a.registerPlugin)("ai-feedback",{render:()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.PluginSidebarMoreMenuItem,{target:"ai-feedback-sidebar",icon:l,children:(0,r.__)("AI Feedback","ai-feedback")}),(0,o.jsx)(i.PluginSidebar,{name:"ai-feedback-sidebar",title:(0,r.__)("AI Feedback","ai-feedback"),icon:l,children:(0,o.jsx)(Z,{})})]})})})();