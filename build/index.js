(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var s in a)e.o(a,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:a[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{getAvailableFocusAreas:()=>g,getAvailableModels:()=>u,getAvailableTones:()=>v,getError:()=>A,getFocusAreas:()=>f,getLastReview:()=>E,getReviewHistory:()=>h,getSelectedModel:()=>_,getSettings:()=>d,getTargetTone:()=>b,getUnresolvedNotesCount:()=>T,hasError:()=>w,isLoadingSettings:()=>p,isReviewing:()=>S});var a={};e.r(a),e.d(a,{clearError:()=>N,fetchSettings:()=>j,receiveSettings:()=>x,setAvailableFocusAreas:()=>C,setAvailableModels:()=>O,setAvailableTones:()=>M,startReview:()=>L,updateSettings:()=>I});const s=window.wp.plugins,i=window.wp.editor,r=window.wp.i18n,n=window.wp.primitives,o=window.ReactJSXRuntime;var l=(0,o.jsx)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,o.jsx)(n.Path,{fillRule:"evenodd",d:"M7.25 16.437a6.5 6.5 0 1 1 9.5 0V16A2.75 2.75 0 0 0 14 13.25h-4A2.75 2.75 0 0 0 7.25 16v.437Zm1.5 1.193a6.47 6.47 0 0 0 3.25.87 6.47 6.47 0 0 0 3.25-.87V16c0-.69-.56-1.25-1.25-1.25h-4c-.69 0-1.25.56-1.25 1.25v1.63ZM4 12a8 8 0 1 1 16 0 8 8 0 0 1-16 0Zm10-2a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z",clipRule:"evenodd"})});const c=window.wp.data;function d(e){return e.settings}function u(e){return e.availableModels}function _(e){return e.settings.defaultModel}function g(e){return e.availableFocusAreas}function f(e){return e.settings.defaultFocusAreas}function v(e){return e.availableTones}function b(e){return e.settings.defaultTone}function S(e){return e.isReviewing}function E(e){return e.lastReview}function h(e){return e.reviewHistory}function A(e){return e.error}function p(e){return e.isLoadingSettings}function T(e){return e.lastReview&&e.lastReview.notes?e.lastReview.notes.filter(e=>!e.resolved).length:0}function w(e){return null!==e.error}const R=window.wp.apiFetch;var m=e.n(R);const y={settings:{defaultModel:"claude-sonnet-4",defaultFocusAreas:["content","tone","flow"],defaultTone:"professional"},availableModels:[],availableFocusAreas:[],availableTones:[],isReviewing:!1,lastReview:null,reviewHistory:[],error:null,isLoadingSettings:!1},k={SET_SETTINGS:"SET_SETTINGS",UPDATE_SETTINGS:"UPDATE_SETTINGS",SET_AVAILABLE_MODELS:"SET_AVAILABLE_MODELS",SET_AVAILABLE_FOCUS_AREAS:"SET_AVAILABLE_FOCUS_AREAS",SET_AVAILABLE_TONES:"SET_AVAILABLE_TONES",START_REVIEW:"START_REVIEW",REVIEW_SUCCESS:"REVIEW_SUCCESS",REVIEW_ERROR:"REVIEW_ERROR",ADD_TO_HISTORY:"ADD_TO_HISTORY",CLEAR_ERROR:"CLEAR_ERROR",SET_LOADING_SETTINGS:"SET_LOADING_SETTINGS"};function*j(){yield{type:k.SET_LOADING_SETTINGS,isLoading:!0};try{return yield m()({path:"/ai-feedback/v1/settings",method:"GET"})}catch(e){throw yield{type:k.REVIEW_ERROR,error:{code:e.code||"unknown_error",message:e.message||"Failed to fetch settings",data:e.data||null}},e}}function x(e){return{type:k.SET_SETTINGS,settings:e}}function*I(e){try{const t=yield m()({path:"/ai-feedback/v1/settings",method:"POST",data:e});return{type:k.SET_SETTINGS,settings:t}}catch(e){throw yield{type:k.REVIEW_ERROR,error:{code:e.code||"unknown_error",message:e.message||"Failed to update settings",data:e.data||null}},e}}function*L({postId:e,model:t,focusAreas:a,targetTone:s}){yield{type:k.START_REVIEW};try{const i=yield m()({path:"/ai-feedback/v1/review",method:"POST",data:{post_id:e,model:t,focus_areas:a,target_tone:s}});return{type:k.REVIEW_SUCCESS,review:i}}catch(e){return{type:k.REVIEW_ERROR,error:{code:e.code||"unknown_error",message:e.message||"Review failed",data:e.data||null}}}}function N(){return{type:k.CLEAR_ERROR}}function O(e){return{type:k.SET_AVAILABLE_MODELS,models:e}}function C(e){return{type:k.SET_AVAILABLE_FOCUS_AREAS,areas:e}}function M(e){return{type:k.SET_AVAILABLE_TONES,tones:e}}const V="ai-feedback/store",F={reducer:function(e=y,t){switch(t.type){case k.SET_SETTINGS:return{...e,settings:{defaultModel:t.settings.default_model,defaultFocusAreas:t.settings.default_focus_areas,defaultTone:t.settings.default_tone},availableModels:t.settings.available_models||[],availableFocusAreas:t.settings.available_focus_areas||[],availableTones:t.settings.available_tones||[],isLoadingSettings:!1};case k.UPDATE_SETTINGS:return{...e,settings:{...e.settings,...t.settings}};case k.SET_AVAILABLE_MODELS:return{...e,availableModels:t.models};case k.SET_AVAILABLE_FOCUS_AREAS:return{...e,availableFocusAreas:t.areas};case k.SET_AVAILABLE_TONES:return{...e,availableTones:t.tones};case k.START_REVIEW:return{...e,isReviewing:!0,error:null};case k.REVIEW_SUCCESS:return{...e,isReviewing:!1,lastReview:t.review,reviewHistory:[t.review,...e.reviewHistory]};case k.REVIEW_ERROR:return{...e,isReviewing:!1,error:t.error};case k.ADD_TO_HISTORY:return{...e,reviewHistory:[t.review,...e.reviewHistory]};case k.CLEAR_ERROR:return{...e,error:null};case k.SET_LOADING_SETTINGS:return{...e,isLoadingSettings:t.isLoading};default:return e}},selectors:t,actions:a,controls:{},resolvers:{*getSettings(){return x(yield j())}}},D=(0,c.createReduxStore)(V,F);(0,c.register)(D);const B=window.wp.components;function P(){const{availableModels:e,selectedModel:t}=(0,c.useSelect)(e=>({availableModels:e(V).getAvailableModels(),selectedModel:e(V).getSelectedModel()}),[]),{updateSettings:a}=(0,c.useDispatch)(V),s=e.reduce((e,t)=>(e[t.provider]||(e[t.provider]=[]),e[t.provider].push(t),e),{}),i=[];return Object.keys(s).forEach(e=>{const t=e.charAt(0).toUpperCase()+e.slice(1);s[e].forEach(e=>{i.push({label:`${t} - ${e.name}`,value:e.id})})}),(0,o.jsx)(B.SelectControl,{label:(0,r.__)("AI Model","ai-feedback"),value:t,options:i,onChange:e=>{a({default_model:e})},help:(0,r.__)("Select the AI model to use for reviews","ai-feedback")})}const G=window.wp.element;function W(){const{availableFocusAreas:e,focusAreas:t,availableTones:a,targetTone:s}=(0,c.useSelect)(e=>({availableFocusAreas:e(V).getAvailableFocusAreas(),focusAreas:e(V).getFocusAreas(),availableTones:e(V).getAvailableTones(),targetTone:e(V).getTargetTone()}),[]),{updateSettings:i}=(0,c.useDispatch)(V),n=(0,G.useRef)(null);(0,G.useEffect)(()=>(n.current=function(e){let t;const a=function(...a){clearTimeout(t),t=setTimeout(()=>e.apply(this,a),500)};return a.cancel=()=>clearTimeout(t),a}(i),()=>{n.current&&n.current.cancel()}),[i]);const l=(0,G.useCallback)((e,a)=>{const s=a?[...t,e]:t.filter(t=>t!==e);n.current({default_focus_areas:s})},[t]),d=(0,G.useCallback)(e=>{n.current({default_tone:e})},[]);return(0,o.jsxs)("div",{className:"ai-feedback-settings",children:[(0,o.jsxs)("fieldset",{children:[(0,o.jsx)("legend",{children:(0,r.__)("Focus Areas","ai-feedback")}),(0,o.jsx)("p",{className:"description",children:(0,r.__)("Select the areas you want AI to focus on when reviewing your content","ai-feedback")}),e.map(e=>(0,o.jsx)(B.CheckboxControl,{label:e.label,help:e.description,checked:t.includes(e.id),onChange:t=>l(e.id,t)},e.id))]}),(0,o.jsx)(B.SelectControl,{label:(0,r.__)("Target Tone","ai-feedback"),value:s,options:a.map(e=>({label:e.label,value:e.id})),onChange:d,help:(0,r.__)("The desired tone for your content","ai-feedback")})]})}function U(){const{postId:e,isReviewing:t,selectedModel:a,focusAreas:s,targetTone:n}=(0,c.useSelect)(e=>({postId:e(i.store).getCurrentPostId(),isReviewing:e(V).isReviewing(),selectedModel:e(V).getSelectedModel(),focusAreas:e(V).getFocusAreas(),targetTone:e(V).getTargetTone()}),[]),{startReview:l}=(0,c.useDispatch)(V),d=!e||t;return(0,o.jsxs)("div",{className:"ai-feedback-review-button",children:[(0,o.jsx)(B.Button,{variant:"primary",onClick:async()=>{if(e)try{await l({postId:e,model:a,focusAreas:s,targetTone:n})}catch(e){console.error("Review failed:",e)}},disabled:d,isBusy:t,children:t?(0,r.__)("Reviewingâ€¦","ai-feedback"):(0,r.__)("Review Document","ai-feedback")}),!e&&(0,o.jsx)("p",{className:"description",children:(0,r.__)("Save your post first to enable review","ai-feedback")}),t&&(0,o.jsx)("p",{className:"description",children:(0,r.__)("AI is analyzing your contentâ€¦","ai-feedback")})]})}function H({review:e}){if(!e||!e.summary)return null;const{summary:t,notes:a,model_used:s}=e;return(0,o.jsxs)("div",{className:"ai-feedback-review-summary",children:[(0,o.jsx)("div",{className:"summary-stats",children:(0,o.jsxs)("div",{className:"stat",children:[(0,o.jsx)("strong",{children:t.total_notes||0}),(0,o.jsx)("span",{children:(0,r.__)("Total Feedback Items","ai-feedback")})]})}),t.by_severity&&(0,o.jsxs)("div",{className:"summary-by-severity",children:[(0,o.jsx)("h4",{children:(0,r.__)("By Severity","ai-feedback")}),(0,o.jsxs)("ul",{children:[t.by_severity.critical>0&&(0,o.jsxs)("li",{children:["ðŸ”´ ",(0,r.__)("Critical","ai-feedback"),":"," ",t.by_severity.critical]}),t.by_severity.important>0&&(0,o.jsxs)("li",{children:["ðŸŸ¡ ",(0,r.__)("Important","ai-feedback"),":"," ",t.by_severity.important]}),t.by_severity.suggestion>0&&(0,o.jsxs)("li",{children:["ðŸŸ¢ ",(0,r.__)("Suggestion","ai-feedback"),":"," ",t.by_severity.suggestion]})]})]}),t.by_category&&(0,o.jsxs)("div",{className:"summary-by-category",children:[(0,o.jsx)("h4",{children:(0,r.__)("By Category","ai-feedback")}),(0,o.jsx)("ul",{children:Object.entries(t.by_category).map(([e,t])=>(0,o.jsxs)("li",{children:[e.charAt(0).toUpperCase()+e.slice(1),": ",t]},e))})]}),s&&(0,o.jsx)("p",{className:"model-used",children:(0,o.jsxs)("em",{children:[(0,r.__)("Reviewed with:","ai-feedback")," ",s]})}),a&&a.length>0&&(0,o.jsxs)("div",{className:"notes-info",children:[(0,o.jsx)("p",{className:"description",children:(0,r.__)("Feedback notes have been attached to your content blocks. Look for the note indicators in the editor.","ai-feedback")}),e.note_ids&&e.note_ids.length>0&&(0,o.jsxs)("p",{className:"success",children:["âœ“ ",(0,r.__)("Created","ai-feedback")," ",e.note_ids.length," ",(0,r.__)("WordPress Notes","ai-feedback")]}),e.notes_error&&(0,o.jsxs)("p",{className:"error",children:["âš  ",(0,r.__)("Note creation warning:","ai-feedback")," ",e.notes_error]})]})]})}function Z(e){return"ai_request_failed"===e.code&&"string"==typeof e.message&&(e.message.toLowerCase().includes("credit")||e.message.toLowerCase().includes("billing"))?(0,o.jsx)(B.Button,{variant:"link",href:"/wp-admin/admin.php?page=ai-feedback-settings",target:"_blank",rel:"noopener noreferrer",className:"ai-feedback-error-action",children:(0,r.__)("Go to Settings","ai-feedback")}):"rate_limit_exceeded"===e.code?(0,o.jsx)("p",{className:"ai-feedback-error-help",children:(0,r.__)("Please wait before making another request.","ai-feedback")}):null}function Y(){const{error:e,lastReview:t,isLoadingSettings:a}=(0,c.useSelect)(e=>({error:e(V).getError(),lastReview:e(V).getLastReview(),isLoadingSettings:e(V).isLoadingSettings()}),[]),{clearError:s}=(0,c.useDispatch)(V);return a?(0,o.jsx)("div",{className:"ai-feedback-panel",children:(0,o.jsx)(B.PanelBody,{children:(0,o.jsx)("p",{children:(0,r.__)("Loadingâ€¦","ai-feedback")})})}):(0,o.jsxs)("div",{className:"ai-feedback-panel",children:[e&&(0,o.jsx)(B.Notice,{status:"error",isDismissible:!0,onRemove:s,className:"ai-feedback-error-notice",children:(0,o.jsxs)("div",{className:"ai-feedback-error-content",children:[(0,o.jsx)("div",{className:"ai-feedback-error-message",children:e.message}),e.code&&(0,o.jsxs)("div",{className:"ai-feedback-error-code",children:[(0,r.__)("Error code:","ai-feedback")," ",e.code]}),Z(e)]})}),(0,o.jsxs)(B.PanelBody,{title:(0,r.__)("Review Settings","ai-feedback"),initialOpen:!0,children:[(0,o.jsx)(P,{}),(0,o.jsx)(W,{})]}),(0,o.jsx)(B.PanelBody,{title:(0,r.__)("Review Document","ai-feedback"),initialOpen:!0,children:(0,o.jsx)(U,{})}),t&&(0,o.jsx)(B.PanelBody,{title:(0,r.__)("Last Review","ai-feedback"),initialOpen:!0,children:(0,o.jsx)(H,{review:t})})]})}(0,s.registerPlugin)("ai-feedback",{render:()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.PluginSidebarMoreMenuItem,{target:"ai-feedback-sidebar",icon:l,children:(0,r.__)("AI Feedback","ai-feedback")}),(0,o.jsx)(i.PluginSidebar,{name:"ai-feedback-sidebar",title:(0,r.__)("AI Feedback","ai-feedback"),icon:l,children:(0,o.jsx)(Y,{})})]})})})();